<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Depot Recovery</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-orange-50 font-sans">
  <header class="bg-orange-600 text-white text-center py-6 shadow-md">
    <h1 class="text-3xl font-bold">Depot Recovery</h1>
  </header>
  <nav class="flex justify-center bg-orange-400 text-white text-lg font-bold">
    <button id="walkthroughTab" class="p-4 hover:bg-orange-500">Walkthrough</button>
    <button id="pullListTab" class="p-4 hover:bg-orange-500">Pull List</button>
    <button id="inventoryTab" class="p-4 hover:bg-orange-500">Inventory</button>
  </nav>
  <main class="p-4">
    <section id="walkthroughSection" class="hidden">
      <h2 class="text-xl font-bold text-orange-700 mb-4">Mark Items Out of Stock</h2>
      <div id="walkthroughList" class="space-y-4"></div>
    </section>

    <section id="pullListSection" class="hidden">
      <h2 class="text-xl font-bold text-orange-700 mb-4">Pull List</h2>
      <div id="pullList" class="space-y-4"></div>
    </section>

    <section id="inventorySection" class="hidden">
      <h2 class="text-xl font-bold text-orange-700 mb-4">Inventory Management</h2>
      <form id="addItemForm" class="space-y-2">
        <input type="text" id="itemName" placeholder="Item Name" required class="p-2 border rounded w-full" />
        <input type="text" id="itemSku" placeholder="Item SKU" required class="p-2 border rounded w-full" />
        <select id="itemCategory" class="p-2 border rounded w-full">
          <option value="Soil">Soil</option>
          <option value="Mulch">Mulch</option>
          <option value="Rock">Rock</option>
          <option value="Brick">Brick</option>
          <option value="Block">Block</option>
          <option value="Paver">Paver</option>
        </select>
        <button type="submit" class="bg-orange-500 text-white p-2 rounded w-full font-bold hover:bg-orange-600">Add Item</button>
      </form>
      <div id="inventoryList" class="space-y-4 mt-4"></div>
    </section>
  </main>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const walkthroughTab = document.getElementById("walkthroughTab");
    const pullListTab = document.getElementById("pullListTab");
    const inventoryTab = document.getElementById("inventoryTab");

    const walkthroughSection = document.getElementById("walkthroughSection");
    const pullListSection = document.getElementById("pullListSection");
    const inventorySection = document.getElementById("inventorySection");

    const walkthroughList = document.getElementById("walkthroughList");
    const pullList = document.getElementById("pullList");
    const inventoryList = document.getElementById("inventoryList");

    function showSection(section) {
      walkthroughSection.classList.add("hidden");
      pullListSection.classList.add("hidden");
      inventorySection.classList.add("hidden");
      section.classList.remove("hidden");
    }

    walkthroughTab.addEventListener("click", () => showSection(walkthroughSection));
    pullListTab.addEventListener("click", () => showSection(pullListSection));
    inventoryTab.addEventListener("click", () => showSection(inventorySection));

    function createItemCard(id, item, context) {
      const card = document.createElement("div");
      card.className = "bg-white p-4 rounded shadow flex justify-between items-center";
      card.innerHTML = `
        <div>
          <p class="font-bold text-lg">${item.sku}</p>
          <p class="text-sm text-gray-600">${item.category}</p>
        </div>
        <div>
          ${context === 'walkthrough' ? `<button class="markOut bg-orange-500 hover:bg-orange-600 text-white font-bold py-1 px-3 rounded" data-id="${id}">Out of Stock</button>` : 
            `<button class="markPulled bg-green-500 hover:bg-green-600 text-white font-bold py-1 px-3 rounded" data-id="${id}">Pulled</button>`}
        </div>
      `;
      return card;
    }

    function updateWalkthroughList(snapshot) {
      walkthroughList.innerHTML = "";
      snapshot.forEach(child => {
        const id = child.key;
        const item = child.val();
        if (!item.outOfStock) {
          const card = createItemCard(id, item, 'walkthrough');
          walkthroughList.appendChild(card);
        }
      });
    }

    function updatePullList(snapshot) {
      pullList.innerHTML = "";
      snapshot.forEach(child => {
        const id = child.key;
        const item = child.val();
        if (item.outOfStock) {
          const card = createItemCard(id, item, 'pullList');
          pullList.appendChild(card);
        }
      });
    }

    db.ref("inventory").on("value", snapshot => {
      updateWalkthroughList(snapshot);
      updatePullList(snapshot);
      inventoryList.innerHTML = "";
      snapshot.forEach(child => {
        const id = child.key;
        const item = child.val();
        const div = document.createElement("div");
        div.className = "bg-white p-4 rounded shadow flex justify-between items-center";
        div.innerHTML = `
          <div>
            <p class="font-bold text-lg">${item.name}</p>
            <p class="text-sm text-gray-600">${item.sku} - ${item.category}</p>
          </div>
          <button class="deleteItem text-red-500 font-bold" data-id="${id}">Delete</button>
        `;
        inventoryList.appendChild(div);
      });
    });

    walkthroughList.addEventListener("click", e => {
      if (e.target.classList.contains("markOut")) {
        const id = e.target.dataset.id;
        db.ref(`inventory/${id}`).update({ outOfStock: true });
      }
    });

    pullList.addEventListener("click", e => {
      if (e.target.classList.contains("markPulled")) {
        const id = e.target.dataset.id;
        db.ref(`inventory/${id}`).update({ outOfStock: false });
      }
    });

    inventoryList.addEventListener("click", e => {
      if (e.target.classList.contains("deleteItem")) {
        const id = e.target.dataset.id;
        db.ref(`inventory/${id}`).remove();
      }
    });

    document.getElementById("addItemForm").addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("itemName").value;
      const sku = document.getElementById("itemSku").value;
      const category = document.getElementById("itemCategory").value;
      db.ref("inventory").push({ name, sku, category, outOfStock: false });
      e.target.reset();
    });

    // Default tab
    showSection(walkthroughSection);
  </script>
</body>
</html>
